<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›‘æ§æ’ä»¶æœ¬åœ°æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        h2 {
            color: #666;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        p {
            color: #666;
            line-height: 1.6;
        }

        button {
            padding: 12px 24px;
            margin: 8px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            background: #1a1a1a;
            color: white;
            transition: background 0.2s;
        }

        button:hover {
            background: #333;
        }

        .error-btn {
            background: #ff4444;
        }

        .error-btn:hover {
            background: #cc0000;
        }

        .success-btn {
            background: #4caf50;
        }

        .success-btn:hover {
            background: #45a049;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .info-box strong {
            color: #1976d2;
        }

        ol {
            line-height: 2;
            color: #666;
        }

        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.875rem;
            margin-left: 10px;
        }

        .status.loading {
            background: #ffa726;
            color: white;
        }

        .status.success {
            background: #4caf50;
            color: white;
        }

        .status.error {
            background: #f44336;
            color: white;
        }

        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
    </style>

    <!-- ç›‘æ§æ’ä»¶åµŒå…¥ä»£ç  - æœ¬åœ°æµ‹è¯•ç‰ˆæœ¬ -->
    <!-- 
      ä½¿ç”¨æ–¹å¼ï¼š
      åœ¨ script æ ‡ç­¾çš„ src å±æ€§ä¸­æ·»åŠ å‚æ•°å³å¯ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨åˆå§‹åŒ–
      
      æ ¼å¼ï¼š
      <script src="./monitoring.js?key=é¡¹ç›®Key&apiUrl=APIåœ°å€"></script>
      
      ç¤ºä¾‹ï¼š
      <script src="./monitoring.js?key=test-project-key&apiUrl=http://localhost:3002"></script>
    -->
    <script src="./monitoring.js?key=test-project-key&apiUrl=http://localhost:3002"></script>
    
    <script>
      // æ£€æŸ¥æ’ä»¶æ˜¯å¦åŠ è½½æˆåŠŸ
      (function() {
        function checkPlugin() {
          if (window.WebPageMonitoring) {
            var config = window.WebPageMonitoring.config;
            if (config.projectKey && config.apiUrl) {
              updateStatus('success', 'ç›‘æ§æ’ä»¶å·²åŠ è½½å¹¶åˆå§‹åŒ–');
              console.log('ç›‘æ§æ’ä»¶å·²åˆå§‹åŒ–');
              console.log('é¡¹ç›®Key:', config.projectKey);
              console.log('APIåœ°å€:', config.apiUrl);
            } else {
              updateStatus('error', 'ç›‘æ§æ’ä»¶é…ç½®ä¸å®Œæ•´ï¼Œè¯·æ£€æŸ¥ script æ ‡ç­¾çš„ src å‚æ•°');
            }
          } else {
            updateStatus('error', 'ç›‘æ§æ’ä»¶åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„');
          }
        }
        
        // ç­‰å¾…æ’ä»¶åŠ è½½
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkPlugin, 100);
          });
        } else {
          setTimeout(checkPlugin, 100);
        }
      })();

      function updateStatus(type, message) {
        var statusEl = document.getElementById('plugin-status');
        if (statusEl) {
          statusEl.className = 'status ' + type;
          statusEl.textContent = message;
        }
      }
    </script>
</head>

<body>
    <div class="container">
        <h1>ç›‘æ§æ’ä»¶æœ¬åœ°æµ‹è¯•é¡µé¢ <span id="plugin-status" class="status loading">åŠ è½½ä¸­...</span></h1>
        <p>è¿™æ˜¯ä¸€ä¸ªç”¨äºæœ¬åœ°å¼€å‘å’Œæµ‹è¯•çš„é¡µé¢ï¼Œç”¨äºéªŒè¯ç›‘æ§æ’ä»¶æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p>

        <div class="info-box">
            <strong>ğŸ“Œ ä½¿ç”¨è¯´æ˜ï¼š</strong>
            <ol>
                <li>ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œåœ¨ <code>http://localhost:3002</code></li>
                <li>åœ¨å‰ç«¯é¢æ¿åˆ›å»ºé¡¹ç›®å¹¶è·å–é¡¹ç›® Key</li>
                <li>åœ¨ script æ ‡ç­¾çš„ src å±æ€§ä¸­æ·»åŠ å‚æ•°ï¼š<code>?key=é¡¹ç›®Key&apiUrl=http://localhost:3002</code></li>
                <li>å°†é¡µé¢ä¸­çš„ <code>key</code> å‚æ•°æ›¿æ¢ä¸ºä½ çš„å®é™…é¡¹ç›® Key</li>
                <li>ç¡®ä¿ <code>monitoring.js</code> æ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œæˆ–ä¿®æ”¹ <code>script.src</code> è·¯å¾„</li>
                <li>æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰æŸ¥çœ‹æ—¥å¿—</li>
                <li>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•å„ç§åŠŸèƒ½</li>
                <li>åœ¨å‰ç«¯é¢æ¿çš„"é¡¹ç›®ç›‘æ§"é¡µé¢æŸ¥çœ‹æ”¶é›†åˆ°çš„æ•°æ®</li>
            </ol>
        </div>

        <h2>æµ‹è¯•åŠŸèƒ½</h2>
        <div>
            <button onclick="testClick()">æµ‹è¯•ç‚¹å‡»äº‹ä»¶</button>
            <button onclick="testError()" class="error-btn">æµ‹è¯•é”™è¯¯æ•è·</button>
            <button onclick="testCustomEvent()">æµ‹è¯•è‡ªå®šä¹‰äº‹ä»¶</button>
            <button onclick="testPageView()" class="success-btn">æ‰‹åŠ¨è§¦å‘é¡µé¢è®¿é—®</button>
            <button onclick="testPerformance()">æµ‹è¯•æ€§èƒ½æ•°æ®</button>
        </div>

        <h2>æµ‹è¯•è¯´æ˜</h2>
        <ul style="line-height: 2; color: #666;">
            <li><strong>ç‚¹å‡»äº‹ä»¶</strong>ï¼šç‚¹å‡»æŒ‰é’®ä¼šè§¦å‘ç‚¹å‡»äº‹ä»¶è¿½è¸ª</li>
            <li><strong>é”™è¯¯æ•è·</strong>ï¼šä¼šæ•…æ„æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œæµ‹è¯•é”™è¯¯è¿½è¸ªåŠŸèƒ½</li>
            <li><strong>è‡ªå®šä¹‰äº‹ä»¶</strong>ï¼šå‘é€ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶åˆ°æœåŠ¡å™¨</li>
            <li><strong>é¡µé¢è®¿é—®</strong>ï¼šæ‰‹åŠ¨è§¦å‘ä¸€æ¬¡é¡µé¢è®¿é—®äº‹ä»¶</li>
            <li><strong>æ€§èƒ½æ•°æ®</strong>ï¼šæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºçš„æ€§èƒ½æŒ‡æ ‡</li>
        </ul>

        <h2>æ£€æŸ¥æ•°æ®</h2>
        <p>æµ‹è¯•å®Œæˆåï¼Œè¯·åˆ°å‰ç«¯é¢æ¿çš„ä»¥ä¸‹ä½ç½®æŸ¥çœ‹æ•°æ®ï¼š</p>
        <ol>
            <li>ç™»å½•å‰ç«¯ç®¡ç†ç³»ç»Ÿ</li>
            <li>è¿›å…¥"é¡¹ç›®ç›‘æ§"é¡µé¢</li>
            <li>é€‰æ‹©å¯¹åº”çš„é¡¹ç›®</li>
            <li>æŸ¥çœ‹"æ•°æ®æ¦‚è§ˆ"ã€"äº‹ä»¶åˆ—è¡¨"ç­‰æ ‡ç­¾é¡µ</li>
        </ol>

        <h2>å¸¸è§é—®é¢˜</h2>
        <div class="info-box">
            <strong>â“ æ’ä»¶æœªåŠ è½½ï¼Ÿ</strong><br>
            æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯ï¼Œç¡®è®¤ <code>monitoring.js</code> æ–‡ä»¶è·¯å¾„æ­£ç¡®ã€‚<br><br>
            
            <strong>â“ æ•°æ®æœªå‘é€ï¼Ÿ</strong><br>
            1. ç¡®è®¤åç«¯æœåŠ¡è¿è¡Œåœ¨ <code>http://localhost:3002</code><br>
            2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„ç½‘ç»œè¯·æ±‚ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰å‘é€åˆ° <code>/api/events</code> çš„è¯·æ±‚<br>
            3. æ£€æŸ¥ CORS è®¾ç½®ï¼Œç¡®ä¿å…è®¸æ¥è‡ªå½“å‰é¡µé¢çš„è¯·æ±‚<br><br>
            
            <strong>â“ é¡¹ç›® Key é”™è¯¯ï¼Ÿ</strong><br>
            åœ¨å‰ç«¯é¢æ¿åˆ›å»ºé¡¹ç›®åï¼Œå¤åˆ¶é¡¹ç›® Key å¹¶æ›¿æ¢é¡µé¢ä¸­çš„ <code>projectKey</code> å€¼ã€‚
        </div>
    </div>

    <script>
        function testClick() {
            console.log('æµ‹è¯•ç‚¹å‡»äº‹ä»¶');
            alert('ç‚¹å‡»äº‹ä»¶å·²è§¦å‘ï¼\n\nè¯·åœ¨å‰ç«¯é¢æ¿çš„"é¡¹ç›®ç›‘æ§" -> "äº‹ä»¶åˆ—è¡¨"ä¸­æŸ¥çœ‹æ•°æ®ã€‚\n\nä¹Ÿå¯ä»¥æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰æŸ¥çœ‹å‘é€çš„è¯·æ±‚ã€‚');
        }

        function testError() {
            console.log('æµ‹è¯•é”™è¯¯æ•è·');
            try {
                // æ•…æ„è§¦å‘ä¸€ä¸ªé”™è¯¯
                throw new Error('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é”™è¯¯ - ' + new Date().toLocaleString());
            } catch (e) {
                console.error('æ•è·åˆ°é”™è¯¯:', e);
                alert('é”™è¯¯å·²è§¦å‘ï¼\n\né”™è¯¯ä¿¡æ¯ï¼š' + e.message + '\n\nè¯·åœ¨å‰ç«¯é¢æ¿æŸ¥çœ‹é”™è¯¯æ•°æ®ã€‚');
            }
        }

        function testCustomEvent() {
            if (window.WebPageMonitoring) {
                window.WebPageMonitoring.track('custom', {
                    action: 'test',
                    message: 'è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶',
                    timestamp: new Date().toISOString(),
                    testData: {
                        button: 'testCustomEvent',
                        page: window.location.href
                    }
                });
                console.log('è‡ªå®šä¹‰äº‹ä»¶å·²å‘é€');
                alert('è‡ªå®šä¹‰äº‹ä»¶å·²å‘é€ï¼\n\nè¯·åœ¨å‰ç«¯é¢æ¿æŸ¥çœ‹æ•°æ®ã€‚');
            } else {
                alert('ç›‘æ§æ’ä»¶æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥æ’ä»¶æ–‡ä»¶è·¯å¾„');
            }
        }

        function testPageView() {
            if (window.WebPageMonitoring) {
                window.WebPageMonitoring.track('pageview', {
                    page_url: window.location.href,
                    page_title: document.title,
                    referrer: document.referrer || ''
                });
                console.log('é¡µé¢è®¿é—®äº‹ä»¶å·²å‘é€');
                alert('é¡µé¢è®¿é—®äº‹ä»¶å·²æ‰‹åŠ¨è§¦å‘ï¼\n\nè¯·åœ¨å‰ç«¯é¢æ¿æŸ¥çœ‹æ•°æ®ã€‚');
            } else {
                alert('ç›‘æ§æ’ä»¶æœªåŠ è½½');
            }
        }

        function testPerformance() {
            if (window.performance && window.performance.timing) {
                const timing = window.performance.timing;
                const perfData = {
                    'DNSæŸ¥è¯¢æ—¶é—´': timing.domainLookupEnd - timing.domainLookupStart + 'ms',
                    'TCPè¿æ¥æ—¶é—´': timing.connectEnd - timing.connectStart + 'ms',
                    'è¯·æ±‚å“åº”æ—¶é—´': timing.responseEnd - timing.requestStart + 'ms',
                    'DOMè§£ææ—¶é—´': timing.domComplete - timing.domInteractive + 'ms',
                    'é¡µé¢åŠ è½½æ—¶é—´': timing.loadEventEnd - timing.navigationStart + 'ms'
                };
                console.log('æ€§èƒ½æ•°æ®:', perfData);
                alert('æ€§èƒ½æ•°æ®å·²è¾“å‡ºåˆ°æ§åˆ¶å°ï¼\n\nè¯·æŒ‰ F12 æ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚');
            } else {
                alert('æµè§ˆå™¨ä¸æ”¯æŒæ€§èƒ½ API');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆæç¤º
        window.addEventListener('load', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œç›‘æ§æ’ä»¶åº”è¯¥å·²ç»å¼€å§‹å·¥ä½œ');
            console.log('å¦‚æœçœ‹åˆ°é”™è¯¯ï¼Œè¯·æ£€æŸ¥ï¼š');
            console.log('1. monitoring.js æ–‡ä»¶æ˜¯å¦å­˜åœ¨');
            console.log('2. åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œåœ¨ http://localhost:3002');
            console.log('3. projectKey æ˜¯å¦æ­£ç¡®');
        });
    </script>
</body>

</html>

